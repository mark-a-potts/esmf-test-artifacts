version: 2.1

commands:
  run-meta-testing:
    parameters:
      branch:
        type: string
    steps:
#     - run:
#         name: Checkout Code (esmf-test-scripts)
#         command: git clone --depth 1 https://github.com/mark-a-potts/esmf-test-artifacts.git
      - run:
          name: Checkout Code (esmf-test-artifacts)
          command: git clone --depth 1 --branch ${CIRCLE_BRANCH} https://github.com/esmf-org/esmf-test-artifacts.git
#     - run:
#         name: Install Dependencies
#         command: pip3 install jsonschema unittest-xml-reporting click gitpython requests python-dateutil pytest-shutil
#     - run:
#         name: python-dateutil dependencies
#         command: sudo pip3 install python-dateutil
#     - run: mkdir -p /tmp/artifacts
#     - run:
#         name: Run Meta Testing
#         command: bash esmf-test-artifacts/.circleci/run.sh << parameters.branch >> << parameters.platform >> << parameters.compiler >> << parameters.comm >>
#     - store_test_results:
#         path: /tmp/artifacts/artifact-tests
#     - store_artifacts:
#         path: /tmp/artifacts/etsumm.log
#     - store_artifacts:
#         path: /tmp/artifacts/artifact-tests.out
#     - run:
#         name: Compress XML Test Output
#         command: cd /tmp/artifacts && zip -r artifact-tests.zip artifact-tests
#     - store_artifacts:
#         path: /tmp/artifacts/artifact-tests.zip
#     - run:
#         name: Check for Failures
#         command: bash esmf-test-artifacts/.circleci/check-for-failures.sh

jobs:

  mt-test:
    docker:
      - image: circleci/python
        auth:
          username: $ESMF_DOCKER_USERNAME
          password: $ESMF_DOCKER_PASSWORD
    steps:
      - run-meta-testing:
          branch: plavac

# commit-read:
#   docker:
#     - image: circleci/python
#       auth:
#         username: $ESMF_DOCKER_USERNAME
#         password: $ESMF_DOCKER_PASSWORD
#   steps:
#     - checkout
#     - run:
#         name: python-dateutil dependencies
#         command: sudo pip3 install python-dateutil
#     - run:
#         name: Read Commit Log file 
#         command: pwd && cd develop && python3 build_html.py
#     - run:
#         name: Push HTML 
#         command: pwd && bash .circleci/html_push.sh 

workflows:

  run-meta-testing:
    jobs:
      - mt-test:
          name: test


# run-read-commit:
#   jobs:
#     - commit-read
